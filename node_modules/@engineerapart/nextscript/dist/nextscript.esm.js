import e from"prop-types";import t from"react";import n from"terser";const s=({scripts:e,minify:t=!0,allowUserMonitoring:n=!0,useFeatureDetection:s=!0,features:r=[]})=>{const i=`gated${s?",always":""}`,o=s?"&ua=chrome/76.0.0":"";return`\n  var _nextscript_feats = [];\n  if (${s}) {\n    ${((e=[])=>e.map(e=>e.test?`${e.test} || _nextscript_feats.push('${e.feature}');`:`_nextscript_feats.push('${e.feature}');`).join("\n"))(r)}\n  } else {\n    _nextscript_feats.push('default');\n  }\n\n  function cs(src, isAsync, useHead, nonce, id) {\n    var s = document.createElement('script');\n    s.src = src;\n    s.async = isAsync;\n    if (nonce) { s.nonce = nonce; }\n    if (id){ s.id = id; }\n    if (useHead) {\n      document.head.appendChild(s);\n    } else {\n      document.body.appendChild(s);\n    }\n  }\n\n  if (_nextscript_feats.length) {\n    // Include a 'ua' argument set to a browser requiring no polyfills to skip UA identification\n    // (improves response time) and avoid being treated as unknown UA (which would\n    // otherwise result in no polyfills, even with 'always', if UA is unknown). Force always\n    // since our feature detection already told us we need them.\n    var src = 'https://cdn.polyfill.io/v2/polyfill.${t?"min.":""}js?features=' + _nextscript_feats.join(',') + '&flags=${i}&rum=${n?1:0}${o}&callback=_nspolyfillComplete';\n    cs(src, true, true);\n  } else {\n    _nspolyfillComplete();\n  }\n\n  function _nspolyfillComplete() {\n    var scripts = [${e}];\n    for (var i = 0; i < scripts.length; i++) {\n      cs(scripts[i].src, scripts[i].async, false, scripts[i].nonce, scripts[i].id);\n    }\n  }\n  `},r={"&":"\\u0026",">":"\\u003e","<":"\\u003c","\u2028":"\\u2028","\u2029":"\\u2029"},i=/[&><\u2028\u2029]/g;const o="static/runtime/amp.js",c="static/runtime/webpack.js";class a extends t.Component{getDynamicChunks(){const{dynamicImports:e,assetPrefix:t}=this.context._documentProps,{_devOnlyInvalidateCacheQueryString:n}=this.context;return e.map(e=>({key:e.file,src:`${t}/_next/${e.file}${n}`,async:!0,nonce:this.props.nonce,crossOrigin:this.props.crossOrigin||process.crossOrigin}))}getScripts(){const{assetPrefix:e,files:t}=this.context._documentProps;if(!t||0===t.length)return[];const{_devOnlyInvalidateCacheQueryString:n}=this.context;return t.map(t=>/\.js$/.exec(t)?{key:t,src:`${e}/_next/${t}${n}`,nonce:this.props.nonce,async:!0,crossOrigin:this.props.crossOrigin||process.crossOrigin}:null).filter(Boolean)}static getInlineScriptSource(e){const{__NEXT_DATA__:t}=e;try{const e=JSON.stringify(t);return e.replace(i,e=>r[e])}catch(n){if(n.message.indexOf("circular structure"))throw new Error(`Circular structure in "getInitialProps" result of page "${t.page}". https://err.sh/zeit/next.js/circular-structure`);throw n}}getPageScripts(){const{staticMarkup:e,assetPrefix:t,__NEXT_DATA__:n}=this.context._documentProps,{_devOnlyInvalidateCacheQueryString:s}=this.context,{page:r,buildId:i,dynamicBuildId:o}=n,c=this.props.crossOrigin||process.crossOrigin,a=[],l=t+(o?`/_next/static/client/pages/_app.${i}.js`:`/_next/static/${i}/pages/_app.js`)+s,u=t+(o?`/_next/static/client/pages${p(r,i)}`:`/_next/static/${i}/pages${p(r)}`)+s;return"/_error"!==r&&a.push({src:u,async:!0,nonce:this.props.nonce,id:`__NEXT_PAGE__${r}`,crossOrigin:c}),a.push({src:l,async:!0,nonce:this.props.nonce,id:"__NEXT_PAGE__/_app",crossOrigin:c}),e||(a.push(...this.getDynamicChunks()),a.push(...this.getScripts())),a}injectScripts(e){const{nonce:t,allowUserMonitoring:n,minify:r,useFeatureDetection:i,features:o,preLoadScripts:c,postLoadScripts:a}=this.props,p=e=>{const n={src:e.src,async:e.async||void 0,nonce:e.nonce||t||void 0,id:e.id||void 0,crossOrigin:e.crossOrigin||void 0};return JSON.stringify(n)},l=[...(c||[]).map(p),...e.map(p),...(a||[]).map(p)];return s({scripts:`\n${l.join(",\n")}\n`,allowUserMonitoring:n,minify:r,useFeatureDetection:i,features:o})}requiresPreloading(){const{useFeatureDetection:e,features:t,preloadPolyfills:n}=this.props;return n&&(e||Array.isArray(t)&&t.length>0)}render(){const{staticMarkup:e,assetPrefix:s,amphtml:r,devFiles:i}=this.context._documentProps,{_devOnlyInvalidateCacheQueryString:p}=this.context,{nonce:l}=this.props,u=this.props.crossOrigin||process.crossOrigin,d=this.getPageScripts(),f=this.requiresPreloading()?n.minify(this.injectScripts(d)).code:null;if(r){if("production"===process.env.NODE_ENV)return null;const n=[o,c];return t.createElement(t.Fragment,null,e?null:t.createElement("script",{id:"__NEXT_DATA__",type:"application/json",nonce:l,crossOrigin:u,dangerouslySetInnerHTML:{__html:a.getInlineScriptSource(this.context._documentProps)},"data-amp-development-mode-only":!0}),n?n.map(e=>t.createElement("script",{key:e,src:`${s}/_next/${e}${p}`,nonce:l,crossOrigin:u,"data-amp-development-mode-only":!0})):null)}return t.createElement(t.Fragment,null,i?i.map(e=>t.createElement("script",{key:e,src:`${s}/_next/${e}${p}`,nonce:l,crossOrigin:u})):null,e?null:t.createElement("script",{id:"__NEXT_DATA__",type:"application/json",nonce:l,crossOrigin:u,dangerouslySetInnerHTML:{__html:a.getInlineScriptSource(this.context._documentProps)}}),f&&t.createElement("script",{id:"__next-preloader",nonce:l,dangerouslySetInnerHTML:{__html:f}}),!f&&d.map((e,n)=>{const s={src:e.src,async:e.async||void 0,nonce:e.nonce||l||void 0,id:e.id||void 0};return t.createElement("script",Object.assign({},s,{key:n}))}))}}function p(e,t){return"/"===e?t?`/index.${t}.js`:"/index.js":t?`${e}.${t}.js`:`${e}.js`}a.contextTypes={_documentProps:e.any,_devOnlyInvalidateCacheQueryString:e.string},a.defaultProps={allowUserMonitoring:!0,minify:!0,preLoadScripts:[],postLoadScripts:[],useFeatureDetection:!0,features:[],preloadPolyfills:!0};const l={DEFAULT:{test:null,feature:"default"},ES6:{test:null,feature:"es6"},ES2015:{test:null,feature:"es2015"},FETCH:{test:"('fetch' in window)",feature:"fetch"},INTERSECTIONOBSERVER:{test:"('IntersectionObserver' in window)",feature:"IntersectionObserver"},CUSTOMEVENT:{test:"(typeof CustomEvent === 'function')",feature:"CustomEvent"},OBJECT_ASSIGN:{test:"('assign' in Object)",feature:"Object.assign"},ARRAY_FROM:{test:"('from' in Array)",feature:"Array.from"},ARRAY_FIND:{test:"('find' in Array.prototype)",feature:"Array.prototype.find"},ARRAY_FINDINDEX:{test:"('findIndex' in Array.prototype)",feature:"Array.prototype.findIndex"},ARRAY_FILL:{test:"('fill' in Array.prototype)",feature:"Array.prototype.fill"},ARRAY_INCLUDES:{test:"('includes' in Array.prototype)",feature:"Array.prototype.includes"},REQUESTANIMATIONFRAME:{test:"('requestAnimationFrame' in window)",feature:"requestAnimationFrame"},INTL:{test:"('Intl' in window)",feature:"Intl"}};export{l as FeaturePolyfills,a as NextScript};
//# sourceMappingURL=nextscript.esm.js.map
