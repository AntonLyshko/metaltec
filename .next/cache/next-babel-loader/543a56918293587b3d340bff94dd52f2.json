{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState, Fragment } from 'react';\nimport $ from 'jquery';\nimport axios from 'axios';\nimport { Form, Button, Row, Col } from 'react-bootstrap';\nimport { setCookie } from 'nookies';\nimport { useRouter } from 'next/router';\nimport ReactLoading from 'react-loading';\n\nconst Cart = (props, ctx) => {\n  const router = useRouter();\n  const {\n    0: state,\n    1: setState\n  } = useState({\n    data: [],\n    sum: 0,\n    delivery: 0,\n    awake: false,\n    step: 1,\n    address: '',\n    state: '',\n    zipcode: '',\n    city: '',\n    name: '',\n    phone: '',\n    email: '',\n    doprava: 'Osobní odběr'\n  });\n\n  const getStorage = async () => {\n    let cartItems = await localStorage.getItem('products');\n    let dataStorage = await JSON.parse(cartItems);\n\n    if (dataStorage) {\n      if (state.data.length != dataStorage.length) {\n        let sum = 0;\n        await dataStorage.forEach(el => {\n          sum += parseInt(el.price, 10) * el.amount;\n        });\n        setState(_objectSpread(_objectSpread({}, state), {}, {\n          data: dataStorage,\n          sum: sum\n        }));\n        console.log(state);\n      }\n    }\n  };\n\n  const updateState = async () => {\n    console.log(state.delivery);\n    let cartItems = await localStorage.getItem('products');\n    let dataStorage = await JSON.parse(cartItems);\n    let sum = 0;\n    await dataStorage.forEach(el => {\n      sum += parseInt(el.price, 10) * el.amount;\n    });\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      data: dataStorage,\n      sum: sum\n    }));\n  };\n\n  const awake = () => {\n    if (!state.awake) {\n      $('.order-step-2').slideUp(0);\n      $('.order-step-loading').hide();\n      $('.address-form-container').slideUp(0);\n      $('.order-step-3').slideUp(0);\n      setState(_objectSpread(_objectSpread({}, state), {}, {\n        awake: true\n      }));\n    }\n  };\n\n  useEffect(() => {\n    getStorage();\n    awake();\n  });\n\n  const deleteProduct = async id => {\n    await props.deleteProduct(id);\n    getStorage();\n  };\n\n  const plus = async (index, id) => {\n    await props.plus(index, id);\n    updateState();\n  };\n\n  const minus = async (index, id) => {\n    await props.minus(index, id);\n    updateState();\n  };\n\n  const loginUser = async () => {\n    console.log('User Signing In');\n    await axios.post('http://localhost:1337/auth/local', {\n      identifier: state.email,\n      password: '123456'\n    }).then(async response => {\n      // Handle success.\n      console.log('Well done!');\n      console.log('User profile', response.data.user);\n      console.log('User token', response.data.jwt);\n      await localStorage.setItem(\"token\", response.data.jwt);\n      await localStorage.setItem(\"user\", response.data.user.id);\n      return await createOrder();\n    }).catch(async error => {\n      console.log('An error occurred:', error.response);\n      return await registerUser();\n    });\n  };\n\n  const registerUser = async () => {\n    console.log('User registration');\n    await axios.post('http://localhost:1337/auth/local/register', {\n      username: state.name,\n      email: state.email,\n      Phone: state.phone,\n      password: '123456'\n    }).then(async response => {\n      console.log('User profile', response.data.user);\n      console.log('User token', response.data.jwt);\n      localStorage.setItem(\"token\", response.data.jwt);\n      localStorage.setItem(\"user\", response.data.user.id);\n    }).catch(error => {\n      console.log('An error occurred:', error.response);\n    });\n  };\n\n  const stepik = async () => {\n    console.log(state);\n    let step = state.step + 1; // input checking\n\n    if (step == 3) {\n      if (state.delivery > 0) {\n        if (state.city.length < 3) {\n          $('.warning').fadeIn();\n          $('input[name=\"city\"]').addClass('warning-input');\n          return;\n        }\n\n        if (state.state.length < 3) {\n          $('.warning').fadeIn();\n          $('input[name=\"state\"]').addClass('warning-input');\n          return;\n        }\n\n        if (state.zipcode.length < 3) {\n          $('.warning').fadeIn();\n          $('input[name=\"zipcode\"]').addClass('warning-input');\n          return;\n        }\n\n        if (state.address.length < 3) {\n          $('.warning').fadeIn();\n          $('input[name=\"address\"]').addClass('warning-input');\n          return;\n        }\n      }\n\n      let fullSum = state.sum + state.delivery;\n      $('.af-class-cart-page-control').slideUp(500);\n      $('.continue-btn').text('Platit ' + fullSum + ' Kč');\n    }\n\n    if (step == 4) {\n      if (state.delivery > 0) {\n        if (state.name.length < 3) {\n          $('.warning').fadeIn();\n          $('input[name=\"name\"]').addClass('warning-input');\n          return;\n        }\n\n        if (state.email.length < 3) {\n          $('.warning').fadeIn();\n          $('input[name=\"email\"]').addClass('warning-input');\n          return;\n        }\n\n        if (state.phone.length < 3) {\n          $('.warning').fadeIn();\n          $('input[name=\"phone\"]').addClass('warning-input');\n          return;\n        }\n      }\n\n      let sum = state.sum + state.delivery;\n      let user = await localStorage.getItem('user');\n      let body = {\n        'City': state.city,\n        'State': state.state,\n        'Address': state.address,\n        'ZipCode': state.zipcode,\n        'Order': state.data,\n        'Delivery': state.doprava,\n        'DeliveryPrice': state.delivery,\n        'Sum': state.sum,\n        'User': user\n      };\n      await setCookie(ctx, 'sum', sum);\n      localStorage.setItem(\"order\", JSON.stringify(body));\n      await loginUser();\n      $('.order-step-loading').show();\n      $('.af-class-cart-page-btn-container').fadeOut(100);\n      router.push('/checkout');\n    }\n\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      step: step\n    }));\n    $('.order-step').slideUp(500);\n    $('.order-step-' + step).slideDown(500);\n  };\n\n  const selectHandle = async e => {\n    let value = $(e.target).val();\n    let doprava = $('.af-class-doprava-select-html option:selected').text();\n    value = parseInt(value, 10);\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      delivery: value,\n      doprava: doprava\n    }));\n\n    if (value > 0) {\n      $('.address-form-container').slideDown(500);\n    }\n  };\n\n  const onChange = e => {\n    $('.warning').fadeOut();\n    $('input').removeClass('warning-input');\n    setState(_objectSpread(_objectSpread({}, state), {}, {\n      [e.target.name]: e.target.value\n    }));\n  };\n\n  return __jsx(\"span\", {\n    className: \"af-view\"\n  }, __jsx(\"div\", {\n    className: \"af-class-body\"\n  }, __jsx(\"div\", {\n    className: \"af-class-main-wrapper\"\n  }, __jsx(\"div\", {\n    className: \"af-class-container w-container\"\n  }, __jsx(\"div\", {\n    className: \"af-class-block\"\n  }, __jsx(\"h1\", {\n    className: \"af-class-block-title\"\n  }, __jsx(\"strong\", {\n    className: \"af-class-bold-text-3\"\n  }, \"Ko\\u0161\\xEDk\"), __jsx(\"br\", null)), __jsx(\"div\", {\n    className: \"af-class-cart-page-container w-clearfix\"\n  }, __jsx(\"div\", {\n    className: \"af-class-order-step-container w-clearfix\"\n  }, __jsx(\"div\", {\n    className: \"af-class-order-step\"\n  }, __jsx(\"div\", {\n    className: \"af-class-cart-items-container order-step-1 order-step\"\n  }, __jsx(Fragment, null, state.data.length ? __jsx(Fragment, null, state.data.map((item, index) => {\n    return __jsx(\"div\", {\n      className: \"af-class-dropdown-cart-item\"\n    }, __jsx(\"div\", {\n      className: \"af-class-amount-control\"\n    }, __jsx(\"div\", {\n      onClick: () => plus(index, item.id),\n      className: \"af-class-plus-amount\"\n    }, __jsx(\"img\", {\n      src: require(\"../images/plus.png\"),\n      loading: \"lazy\",\n      alt: true,\n      className: \"af-class-image-9\"\n    })), __jsx(\"div\", {\n      className: \"af-class-amount\"\n    }, __jsx(\"div\", {\n      className: \"af-class-text-block-9\"\n    }, item.amount)), __jsx(\"div\", {\n      className: \"af-class-minus-amount\"\n    }, __jsx(\"img\", {\n      onClick: () => minus(index, item.id),\n      src: require(\"../images/minys.png\"),\n      loading: \"lazy\",\n      alt: true,\n      className: \"af-class-image-10\"\n    }))), __jsx(\"div\", {\n      className: \"af-class-dropdown-cart-img\"\n    }, __jsx(\"img\", {\n      src: `http://localhost:1337${item.image}`,\n      loading: \"lazy\",\n      alt: true,\n      className: \"af-class-image-7 cart-preview-img\"\n    })), __jsx(\"div\", {\n      className: \"af-class-dropdown-cart-desc\"\n    }, __jsx(\"h1\", {\n      className: \"af-class-dropdown-cart-title\"\n    }, item.name), __jsx(\"div\", {\n      className: \"af-class-dropdown-cart-cost\"\n    }, item.price, \" K\\u010D\")), __jsx(\"div\", {\n      onClick: () => deleteProduct(item.id),\n      className: \"af-class-dropdown-item-control\"\n    }, __jsx(\"img\", {\n      src: require(\"../images/cross.png\"),\n      loading: \"lazy\",\n      alt: true,\n      className: \"af-class-image-8\"\n    })));\n  })) : __jsx(Fragment, null, __jsx(\"div\", {\n    className: \"prazdni-kosik\"\n  }, \"Ko\\u0161\\xEDk pr\\xE1zdn\\xFD\")))), __jsx(\"div\", {\n    className: \"af-class-cart-page-control\"\n  }, __jsx(\"div\", {\n    className: \"af-class-cart-page-sum\"\n  }, __jsx(\"div\", {\n    className: \"af-class-sum-container af-class-page\"\n  }, __jsx(\"h5\", {\n    className: \"af-class-sum-title af-class-page\"\n  }, \"Sou\\u010Det\"), __jsx(\"h5\", {\n    className: \"af-class-sum-title af-class-page\"\n  }, state.sum + state.delivery, \" K\\u010D\")))), __jsx(\"div\", {\n    className: \"af-class-order-step order-step-2 order-step\"\n  }, __jsx(\"div\", {\n    className: \"doprava-title\"\n  }, \"Vyberte zp\\u016Fsob doru\\u010Den\\xED\"), __jsx(\"div\", {\n    className: \"af-class-cart-page-doprava\"\n  }, __jsx(\"div\", {\n    className: \"af-class-doprava-select-container\"\n  }, __jsx(\"div\", {\n    className: \"af-class-doprava-select w-embed\"\n  }, __jsx(\"p\", null, __jsx(\"select\", {\n    onChange: e => selectHandle(e),\n    className: \"af-class-doprava-select-html\",\n    size: 1\n  }, __jsx(\"option\", {\n    className: \"af-class-doprava-option\",\n    selected: true,\n    value: 0\n  }, \"Osobn\\xED odb\\u011Br\"), __jsx(\"option\", {\n    className: \"af-class-doprava-option\",\n    value: 75\n  }, \"\\u010Cesk\\xE1 po\\u0161ta Bal\\xEDk do ruky\"), __jsx(\"option\", {\n    className: \"af-class-doprava-option\",\n    value: 89\n  }, \"PPL standardn\\xED doru\\u010Den\\xED\"))), __jsx(\"style\", {\n    dangerouslySetInnerHTML: {\n      __html: \"\\n   .af-view .af-class-doprava-select-html{\\n      border: none;\\n      padding: 5px 5px 0px 5px;\\n      border-radius: 5px;\\n     }\\n   .af-view .af-class-doprava-option{\\n   \\t\\tborder-radius: 5px;\\n      padding: 2px;\\n   }\\n   .af-view .af-class-doprava-option:hover{\\n   \\t\\tbackground: #f4f4f4;\\n   }\\n   \"\n    }\n  }))), __jsx(\"div\", {\n    className: \"af-class-sum-sum\"\n  }, __jsx(\"h5\", {\n    className: \"af-class-sum-sum-content\"\n  }, state.delivery), __jsx(\"h5\", {\n    className: \"af-class-sum-title af-class-page af-class-doprava\"\n  }, \" K\\u010D\"))), __jsx(\"div\", {\n    className: \"address-form-container\"\n  }, __jsx(Form, null, __jsx(Row, null, __jsx(Col, {\n    xs: 12,\n    md: 6\n  }, __jsx(Form.Group, null, __jsx(Form.Label, null, \"M\\u011Bsto\"), __jsx(Form.Control, {\n    onChange: e => onChange(e),\n    value: state.city,\n    name: \"city\",\n    type: \"text\",\n    placeholder: \"Praha\"\n  })), __jsx(Form.Group, null, __jsx(Form.Label, null, \"PS\\u010C\"), __jsx(Form.Control, {\n    onChange: e => onChange(e),\n    value: state.zipcode,\n    name: \"zipcode\",\n    type: \"text\",\n    placeholder: \"150 00\"\n  }))), __jsx(Col, {\n    xs: 12,\n    md: 6\n  }, __jsx(Form.Group, null, __jsx(Form.Label, null, \"Okres\"), __jsx(Form.Control, {\n    onChange: e => onChange(e),\n    value: state.state,\n    name: \"state\",\n    type: \"text\",\n    placeholder: \"Praha 5\"\n  })), __jsx(Form.Group, null, __jsx(Form.Label, null, \"Adresa, Apartment\"), __jsx(Form.Control, {\n    onChange: e => onChange(e),\n    value: state.address,\n    name: \"address\",\n    type: \"text\",\n    placeholder: \"Adresa, Apartment\"\n  }))))), __jsx(\"div\", {\n    className: \"warning\"\n  }, \"T\\u0159eba vyplnit v\\u0161echna pole\"))), __jsx(\"div\", {\n    className: \"af-class-order-step order-step-3 order-step\"\n  }, __jsx(\"div\", {\n    className: \"auth-step-container\"\n  }, __jsx(Form, null, __jsx(Form.Group, {\n    controlId: \"formBasicEmail\"\n  }, __jsx(Form.Label, null, \"Cel\\xE9 jm\\xE9no\"), __jsx(Form.Control, {\n    onChange: e => onChange(e),\n    type: \"text\",\n    name: \"name\",\n    placeholder: \"Zadejte sv\\xE9 cel\\xE9 jm\\xE9no\",\n    value: state.name\n  })), __jsx(Form.Group, {\n    controlId: \"formBasicEmail\"\n  }, __jsx(Form.Label, null, \"Email\"), __jsx(Form.Control, {\n    onChange: e => onChange(e),\n    type: \"email\",\n    name: \"email\",\n    placeholder: \"Zadejte email\",\n    value: state.email\n  })), __jsx(Form.Group, {\n    controlId: \"formBasicPassword\"\n  }, __jsx(Form.Label, null, \"Telefonn\\xED \\u010D\\xEDslo\"), __jsx(Form.Control, {\n    onChange: e => onChange(e),\n    value: state.phone,\n    name: \"phone\",\n    type: \"phone\",\n    placeholder: \"Zadejte telefonn\\xED \\u010D\\xEDslo\"\n  }))))), __jsx(\"div\", {\n    className: \"order-step-loading\"\n  }, __jsx(\"div\", {\n    className: \"loading-element\"\n  }, __jsx(ReactLoading, {\n    type: 'bubbles',\n    color: \"#ff373a\"\n  }))), __jsx(Fragment, null, state.data.length ? __jsx(Fragment, null, __jsx(\"div\", {\n    className: \"af-class-cart-page-btn-container\"\n  }, __jsx(\"a\", {\n    onClick: () => stepik(),\n    href: \"#\",\n    className: \"af-class-button-2 af-class-order-btn-1 w-button continue-btn\"\n  }, \"Pokra\\u010Dovat\"))) : __jsx(Fragment, null)))), __jsx(\"div\", {\n    className: \"af-class-cart-script w-embed w-script\"\n  })))))));\n};\n\nexport default Cart;","map":null,"metadata":{},"sourceType":"module"}